buildscript {
  ext {
    kotlin_version = '1.3.50'
    kotlin_test_version = '3.3.1'
    assertj_version = '3.13.2'
  }
  repositories {
    mavenCentral()
  }
}

plugins {
  id 'org.jetbrains.kotlin.jvm' version '1.3.50'
  id 'org.jetbrains.kotlin.kapt' version '1.3.50'
  id 'com.github.johnrengelman.shadow' version '5.0.0'
}

allprojects {
  repositories {
    maven { url "https://kotlin.bintray.com/kotlinx" }
    mavenCentral()
    jcenter()
  }

  group = 'io.arrow-kt'

  //When updating version it must be also changed in ArrowKotlinGradleSubplugin#VERSION
  version = '0.0.1'
}

task deployMeta {
  dependsOn ':compiler-plugin:publishToMavenLocal'
  dependsOn ':gradle-plugin:publishArrowPluginMarkerMavenPublicationToMavenLocal'
  dependsOn ':gradle-plugin:publishPluginMavenPublicationToMavenLocal'
  dependsOn ':gradle-plugin:publishToMavenLocal'
}

task buildMeta {
  dependsOn 'build'
  dependsOn 'deployMeta'

  tasks.findByPath(':deployMeta').mustRunAfter 'build'
}

task publishAndRunIde {
  dependsOn ':buildMeta'
  dependsOn ':idea-plugin:runIde'
  tasks.findByPath(':idea-plugin:runIde').mustRunAfter ':buildMeta'
}
