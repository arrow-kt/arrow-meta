buildscript {
  ext {
    kotlin_version = '1.3.50'
    kotlin_test_version = '3.3.1'
    assertj_version = '3.13.2'
  }
  repositories {
    mavenCentral()
  }
}

plugins {
  id 'org.jetbrains.kotlin.jvm' version '1.3.50'
  id 'org.jetbrains.kotlin.kapt' version '1.3.50'
  id 'com.github.johnrengelman.shadow' version '5.0.0'
}

allprojects {
  repositories {
    maven { url "https://kotlin.bintray.com/kotlinx" }
    mavenCentral()
    jcenter()
  }
}

task buildMeta {
  dependsOn 'clean'
  dependsOn 'build'
  dependsOn 'test'
  dependsOn ':gradle-plugin:publishArrowPluginMarkerMavenPublicationToMavenLocal'
  dependsOn ':gradle-plugin:publishPluginMavenPublicationToMavenLocal'
  tasks.findByPath(':gradle-plugin:publishArrowPluginMarkerMavenPublicationToMavenLocal').mustRunAfter 'build'
  tasks.findByPath(':gradle-plugin:publishPluginMavenPublicationToMavenLocal').mustRunAfter 'build'
}

task publishAndRunIde {
  dependsOn ':buildMeta'
  dependsOn ':idea-plugin:runIde'
  tasks.findByPath(':idea-plugin:runIde').mustRunAfter ':buildMeta'
}
